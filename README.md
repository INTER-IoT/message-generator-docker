# IPSM Message Generator deployment
The deployment of the `IPSM Message Generator` uses the
 * [interiot/message-generator](https://hub.docker.com/r/interiot/message-generator/)

`Docker` image.

## Content of the repository
Repository contains the following files and folders
 * `scripts` – utility scripts used by `configure.sh`
 * `templates` – sample message templates
 * `docker-compose.yml` – definition of the `IPSM` deployment (to be used with `Docker Compose`)
 * `config.env` – configuration file
 * `configure.sh` – configuration script
 * `README.md` – this file

## Installation process
The `Message Generator` deployment needs a working `Docker` installation. The deployment process has been tested using `Docker` (version 17.09.0-ce) and `Docker Compose` (version 1.17.0). It is advisable to install both tools manually and not rely on versions found in third-party repositories, as they tend to be outdated.

### SSL setup
The deployment also requires a working SSL setup for the Apache Kafka client. Such a setup (utilizing self-signed certificates) can be generated by cloning the [`ipsm-ssl`](https://github.com/INTER-IoT/ipsm-ssl.git) repository

```bash
git clone https://github.com/INTER-IoT/ipsm-ssl.git
```

and following instructions provided in its `README.md` file.

*Important!* Make sure that the `IPSM` and the `Message Generator` deployments use *the same* SSL setup, otherwise the `Message Generator` will not work properly.

### Cloning the repository
Assuming that the SSL setup has been created, in the next step you need to clone the main `IPSM Dashboard` Docker deployment git repository.
```bash
git clone https://github.com/INTER-IoT/message-generator-docker.git
cd message-generator-docker
```

### Environment variables
The `config.env` configuration file, located in the main folder of the repository, defines three environment variables:

 * `SSL_CONFIG` – should point to the main directory of the (properly configured) copy of the `ipsm-ssl` repository,
 * `IPSM_KAFKA_HOST` – the default `10.0.2.15` IP address *should be changed* to the IP address of the `IPSM` deployment machine (don't use `localhost` nor `127.0.0.1`),
 * `IPSM_KAFKA_PORT` – defines the port number for the `Kafka` (can be left as is, provided that `9092` as the default Kafka port has not been changed in the `ipsm-docker` configuration)

### Configuration script
To finish the deployment configuration process invoke the command

```bash
bash ./configure.sh
```

Finally, to retrieve the image, create and start the Message Generator container execute the following command

```bash
docker-compose up -d
```

